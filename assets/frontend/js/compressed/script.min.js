function filterBrand(t,e){var a="",n=getParams(),r=Object.keys(n).length;if($("#wrap_sanpham").length>0)if(a=window.location.href,1==e)0==r&&(a+="?"),void 0==n.brand?(r>0&&(a+="&"),a+="brand="+t,window.location.href=a):-1==n.brand.indexOf(t)&&(a+="-"+t,window.location.href=a);else{var i="";i=-1!=n.brand.indexOf(t+"-")?t+"-":-1!=n.brand.indexOf("-"+t)?"-"+t:t;var o=n.brand.replace(i,""),c=a.replace(i,"");""==o&&(c=-1!=c.indexOf("?brand=")?c.replace("?brand=",""):c.replace("&brand=","")),window.location.href=c}else a+=fUrl+"san-pham/c0?brand="+t,window.location.href=a}function getParams(t){var e={};return location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,a,n){e[a]=n}),t?e[t]:e}function ajax_update_cart(t,e){$.ajax({url:fUrl+"ajax_update_cart",type:"POST",cache:!1,dataType:"json",data:{csrf_hash:$.cookie("csrf_cookie_ci"),post_id:t,number_item:e},success:function(e){if(1==e.error)swal("Rất tiếc...",e.msg,"error");else{e.total_item<=99?$("#wrap_cart #cart_number").html(e.total_item):$("#wrap_cart #cart_number").html("99<plus>+</plus>");var a=$.number(e.sub_total,0,",",".");$(".wrap_item_"+t).find(".col_sub_total").find(".sub_total").children("span:last-child").html(a);var n=$.number(e.total,0,",",".");$(".wrap_giohang_tong").find(".total").html(n),$(".wrap_lbl_giohang").find(".number_item").html(e.total_item)}},error:function(){}})}function add_cart(){$(".add_cart").click(function(t){t.preventDefault();var e=0,a=new Array;$("body").find(".number_input").each(function(){var t=parseInt($(this).val());e+=t;var n=$(this).attr("data-id");a.push({post_id:n,number_item:e})}),e>0&&a.length>0&&$.ajax({url:fUrl+"ajax_add_cart",type:"POST",cache:!1,dataType:"json",data:{csrf_hash:$.cookie("csrf_cookie_ci"),arr_data:a},success:function(t){1==t.error?swal("Rất tiếc...",t.msg,"error"):(t.total_item<=99?$("#wrap_cart #cart_number").html(t.total_item):$("#wrap_cart #cart_number").html("99<plus>+</plus>"),swal("Cám ơn bạn!","Sản phẩm đã được thêm vào giỏ hàng.","success"))},error:function(){swal("Rất tiếc...","Lỗi không thể thêm sản phẩm vào giỏ hàng.","error")}})})}function number_input(t){$("body").on("keypress",t,function(t){var e=t.keyCode||t.which;return e>=48&&57>=e?!0:void t.preventDefault()}),$("body").on("keyup",t,function(){var t=$(this),e=$.trim(t.val()).length;return 1==e&&"0"==t.val()&&t.val("1"),e>=5&&t.val(t.val().substr(0,4)),!0}),$("body").on("focus",t,function(t){var e=$(this);""==e.val()&&e.val("1")}),$("body").on("blur",t,function(t){var e=$(this),a=$.trim(e.val()).length;if(0==a?e.val("1"):a>=5&&e.val(e.val().substr(0,4)),in_cart){var n=e.attr("data-id"),r=e.val();ajax_update_cart(n,r)}}),$("body").on("change",t,function(t){var e=$(this),a=e.prev(),n=e.next(),r=parseInt(e.val());if(1>=r?a.attr("disabled","disabled"):r>=js_data.max_number_item_cart?n.attr("disabled","disabled"):(a.removeAttr("disabled"),n.removeAttr("disabled")),in_cart&&r>=1&&r<js_data.max_number_item_cart){var i=e.attr("data-id"),o=r;ajax_update_cart(i,o)}}),$(".btn_increase").click(function(){var t=$(this),e=$(this).prev(),a=e.prev(),n=parseInt(e.val()),r=n+1;if(e.val(r),a.removeAttr("disabled"),n>=js_data.max_number_item_cart&&t.attr("disabled","disabled"),in_cart&&r<js_data.max_number_item_cart){var i=e.attr("data-id"),o=r;ajax_update_cart(i,o)}}),$(".btn_decrease").click(function(){var t=$(this),e=t.next(),a=e.next(),n=parseInt(e.val()),r=n-1;if(e.val(r),a.removeAttr("disabled"),1==r&&t.attr("disabled","disabled"),in_cart&&r>=1){var i=e.attr("data-id"),o=r;ajax_update_cart(i,o)}})}function init_select2(t,e,a){t.val("").trigger("change"),t.select2({placeholder:e,matcher:matchCustom}),void 0!=a&&""!=a&&t.val(a).trigger("change")}function matchCustom(t,e){if(""===$.trim(t.term))return e;if("undefined"==typeof e.text)return null;var a=e.text.toLowerCase(),n=t.term.toLowerCase();if(a.indexOf(n)>-1){var r=$.extend({},e,!0);return r}return null}function show_sweetalert(t,e,a){swal(t,e,a)}var document_height=$(document).height(),screen_height=$(window).height(),screen_width=$(window).width(),footer_height=$("#wrap_footer").height();js_data.invalid&&swal("Rất tiếc...",js_data.invalid,"error"),$("#gotoTop").affix({offset:{bottom:footer_height+80}}),$(window).scroll(function(t){var e=$(window).scrollTop();e>=200?$("#gotoTop").fadeIn("fast"):$("#gotoTop").fadeOut("fast")}),$("body").on("click","#gotoTop",function(){$("html, body").animate({scrollTop:0},600,function(){$("#gotoTop").fadeOut("fast")})});var in_cart=!1;$("#wrap_giohang").length>0&&(in_cart=!0),$(document).ready(function(){$("#wrap_sanpham").length>0&&$("html, body").animate({scrollTop:515},600);var t="",e="",a="";switch(void 0!=js_data.valid?a=js_data.valid:void 0!=js_data.invalid&&(a=js_data.invalid),a){case"checkout_success":t="Cám ơn bạn!",e="Đơn hàng của bạn đã được tiếp nhận. <br/>Chúng tôi sẽ liên lạc với bạn trong thời gian sớm nhất.",show_sweetalert(t,e,"success");break;case"checkout_error":t="Rất tiếc!",e="Đơn hàng của bạn chưa được tiếp nhận. <br/>Vui lòng liên hệ với chúng tôi để được hỗ trợ tốt hơn.",show_sweetalert(t,e,"error")}if($('[rel="popover"]').popover({container:"body",placement:"bottom",html:!0,content:function(){var t=$($(this).data("popover-content")).clone(!0).removeClass("hide");return t}}),$("#nav_sanpham").webuiPopover({url:"#nav_sanpham_popover",placement:"bottom-right",onShow:function(t){$("html, body").animate({scrollTop:0},600,function(){$("body").addClass("fixed"),$("#nav_sanpham_bg").fadeIn(100)})},onHide:function(t){$("body").removeClass("fixed"),$("#nav_sanpham_bg").fadeOut("fast")}}),$(".product_category").find("i.glyphicon.glyphicon-chevron-down").click(function(){$(this).next("ul").removeClass("hidden-xs").slideDown("fast"),$(this).remove()}),$(".product_category").find("i.glyphicon.glyphicon-chevron-down").is(":visible")&&$(".product_category").find(".title").click(function(){$(".product_category").find("i.glyphicon.glyphicon-chevron-down").click()}),$("#slick_hotline").slick({infinite:!0,lazyLoad:"ondemand",slidesToShow:4,slidesToScroll:1}),768>=screen_width?($("#slick_hot_product").slick({infinite:!0,lazyLoad:"ondemand",slidesToShow:1,slidesToScroll:1}),$("#slick_sale_product").slick({infinite:!0,lazyLoad:"ondemand",slidesToShow:1,slidesToScroll:1})):($("#slick_hot_product").slick({infinite:!0,lazyLoad:"ondemand",slidesToShow:3,slidesToScroll:1}),$("#slick_sale_product").slick({infinite:!0,lazyLoad:"ondemand",slidesToShow:3,slidesToScroll:1})),$("#wrap_left").length>0){var n=$(".product_category");n.children("ul.parent").children("li.hasSub").click(function(){$(this).find("ul.child").slideToggle(),$(this).find(".fa-caret-down").length>0?$(this).find("i.fa.fa-caret-down").removeClass("fa-caret-down").addClass("fa-caret-left"):$(this).find("i.fa.fa-caret-left").removeClass("fa-caret-left").addClass("fa-caret-down")})}if($(".elastislide-list").length>0&&$("#carousel").elastislide({orientation:"vertical",autoplay:!1,minItems:5}),$("div.wrap_paging").jPages({containerID:"related_products",perPage:3,previous:"",next:""}),$(".item_number").find('input[name="item_number"]').length>0&&(number_input(".number_input"),add_cart()),$("#wrap_giohang").length>0&&$(".wrap_giohang_item").find(".delete_item").click(function(t){t.preventDefault();var e=$(this).parent().parent(".wrap_giohang_item"),a=$(this).attr("data-id");swal({title:"Tân Nhật Quang",text:"Bạn có thật sự muốn xóa sản phẩm này khỏi giỏ hàng ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Xóa",cancelButtonText:"Không"}).then(function(){$.ajax({url:fUrl+"ajax_delete_cart",type:"POST",cache:!1,dataType:"json",data:{csrf_hash:$.cookie("csrf_cookie_ci"),post_id:a},success:function(t){if(1==t.error)swal("Rất tiếc...",t.msg,"error");else{e.fadeOut("slow"),t.total_item<=99?($("#wrap_cart #cart_number").html(t.total_item),0==t.total_item&&$(".btn_dathang").remove()):$("#wrap_cart #cart_number").html("99<plus>+</plus>");var n=$.number(t.sub_total,0,",",".");$(".wrap_item_"+a).find(".col_sub_total").find(".sub_total").children("span:last-child").html(n);var r=$.number(t.total,0,",",".");$(".wrap_giohang_tong").find(".total").html(r),$(".wrap_lbl_giohang").find(".number_item").html(t.total_item)}},error:function(){}})})}),$("#wrap_checkout").length>0&&$("#frmCustomer").length>0){var r=$('select[name="province_id_1"]'),i=$('select[name="province_id_2"]'),o=$('select[name="district_id_1"]'),c=$('select[name="district_id_2"]');init_select2(r,"Chọn tỉnh/thành phố"),init_select2(i,"Chọn tỉnh/thành phố"),init_select2(o,"Chọn quận/huyện"),init_select2(c,"Chọn quận/huyện");var l;r.change(function(){l=$(this).val(),o.val("").trigger("change"),o.select2({minimumResultsForSearch:-1,ajax:{url:fUrl+"ajax_get_district",dataType:"json",method:"post",data:function(){return{csrf_hash:$.cookie("csrf_cookie_ci"),province_id:l}},processResults:function(t){return{results:t}}}})}),$('input[name="same_address"]').change(function(){0==$(this).val()?($(".different_address").slideDown(),$('input[name="address_2"]').val("")):$(".different_address").slideUp()}),i.change(function(){l=$(this).val(),c.val("").trigger("change"),c.select2({minimumResultsForSearch:-1,ajax:{url:fUrl+"ajax_get_district",dataType:"json",method:"post",data:function(){return{csrf_hash:$.cookie("csrf_cookie_ci"),province_id:l}},processResults:function(t){return $('input[name="csrf_hash"]').val($.cookie("csrf_cookie_ci")),{results:t}}}})}),justNum($('input[name="phone"]'));var s=$("#frmCustomer").validate({rules:{fullname:{required:!0,maxlength:512},phone:{required:!0,maxlength:20},email:{email:!0}},messages:{fullname:{required:"bắt buộc nhập",maxlength:"tối đa 512 ký tự"},phone:{required:"bắt buộc nhập",maxlength:"tối đa 20 số"},email:{email:"email không đúng định dạng"}},highlight:function(t){$(t).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(t){$(t).closest(".form-group").removeClass("has-error").addClass("has-success")},errorElement:"span",errorClass:"help-block",errorPlacement:function(t,e){e.parent(".input-group").length?t.insertAfter(e.parent()):t.insertAfter(e)},submitHandler:function(t){$('input[name="csrf_hash"]').attr("value",$.cookie("csrf_cookie_ci")),t.submit()}})}$("#frmSearch").find(".product_search").keypress(function(t){return t.preventDefault(),13==t.which?(alert("You pressed enter!"),!1):void 0}),$("#frmSearch").find(".btn").click(function(t){t.preventDefault();var e=$("#frmSearch").find('input[name="product_search"]').val().trim();if(0==e.length)swal("Rất tiếc...","Vui lòng nhập tên hoặc mã sản phẩm cần tìm kiếm","error");else{var a={cat:"sp",search:e},n=jQuery.param(a);window.location.href=fUrl+"san-pham?"+n}}),$(".manufacturer").length>0&&($(".manufacturer").find(".brand-item label").each(function(){$(this).click(function(){var t=$(this).parent("li"),e=t.children("input"),a=e.val();e.is(":checked")?(e.prop("checked",!1),filterBrand(a,!1)):(e.prop("checked",!0),filterBrand(a,!0))})}),$(".manufacturer").find('.brand-item input[type="checkbox"]').each(function(){$(this).click(function(){var t=$(this),e=t.val();t.is(":checked")?filterBrand(e,!0):filterBrand(e,!1)})})),$("#brand-wrap").length>0&&($("#brand-wrap").find(".brand-item label").each(function(){$(this).click(function(){var t=$(this).parent("li"),e=t.children("input"),a=e.val();e.is(":checked")?(e.prop("checked",!1),filterBrand(a,!1)):(e.prop("checked",!0),filterBrand(a,!0))})}),$("#brand-wrap").find('.brand-item input[type="checkbox"]').each(function(){$(this).click(function(){var t=$(this),e=t.val();t.is(":checked")?filterBrand(e,!0):filterBrand(e,!1)})}))});