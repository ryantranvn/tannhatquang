function ajax_update_cart(t,a){$.ajax({url:fUrl+"ajax_update_cart",type:"POST",cache:!1,dataType:"json",data:{csrf_hash:$.cookie("csrf_cookie_ci"),post_id:t,number_item:a},success:function(a){if(1==a.error)swal("Rất tiếc...",a.msg,"error");else{a.total_item<=99?$("#wrap_cart #cart_number").html(a.total_item):$("#wrap_cart #cart_number").html("99<plus>+</plus>");var e=$.number(a.sub_total,0,",",".");$(".wrap_item_"+t).find(".col_sub_total").find(".sub_total").children("span:last-child").html(e);var r=$.number(a.total,0,",",".");$(".wrap_giohang_tong").find(".total").html(r),$(".wrap_lbl_giohang").find(".number_item").html(a.total_item)}},error:function(){}})}function add_cart(){$(".add_cart").click(function(t){t.preventDefault();var a=0,e=new Array;$("body").find(".number_input").each(function(){var t=parseInt($(this).val());a+=t;var r=$(this).attr("data-id");e.push({post_id:r,number_item:a})}),a>0&&e.length>0&&$.ajax({url:fUrl+"ajax_add_cart",type:"POST",cache:!1,dataType:"json",data:{csrf_hash:$.cookie("csrf_cookie_ci"),arr_data:e},success:function(t){1==t.error?swal("Rất tiếc...",t.msg,"error"):(t.total_item<=99?$("#wrap_cart #cart_number").html(t.total_item):$("#wrap_cart #cart_number").html("99<plus>+</plus>"),swal("Cám ơn bạn!","Sản phẩm đã được thêm vào giỏ hàng.","success"))},error:function(){swal("Rất tiếc...","Lỗi không thể thêm sản phẩm vào giỏ hàng.","error")}})})}function number_input(t){$("body").on("keypress",t,function(t){var a=t.keyCode||t.which;return a>=48&&57>=a?!0:void t.preventDefault()}),$("body").on("keyup",t,function(){var t=$(this),a=$.trim(t.val()).length;return 1==a&&"0"==t.val()&&t.val("1"),a>=5&&t.val(t.val().substr(0,4)),!0}),$("body").on("focus",t,function(t){var a=$(this);""==a.val()&&a.val("1")}),$("body").on("blur",t,function(t){var a=$(this),e=$.trim(a.val()).length;if(0==e?a.val("1"):e>=5&&a.val(a.val().substr(0,4)),in_cart){var r=a.attr("data-id"),n=a.val();ajax_update_cart(r,n)}}),$("body").on("change",t,function(t){var a=$(this),e=a.prev(),r=a.next(),n=parseInt(a.val());if(1>=n?e.attr("disabled","disabled"):n>=js_data.max_number_item_cart?r.attr("disabled","disabled"):(e.removeAttr("disabled"),r.removeAttr("disabled")),in_cart&&n>=1&&n<js_data.max_number_item_cart){var i=a.attr("data-id"),o=n;ajax_update_cart(i,o)}}),$(".btn_increase").click(function(){var t=$(this),a=$(this).prev(),e=a.prev(),r=parseInt(a.val()),n=r+1;if(a.val(n),e.removeAttr("disabled"),r>=js_data.max_number_item_cart&&t.attr("disabled","disabled"),in_cart&&n<js_data.max_number_item_cart){var i=a.attr("data-id"),o=n;ajax_update_cart(i,o)}}),$(".btn_decrease").click(function(){var t=$(this),a=t.next(),e=a.next(),r=parseInt(a.val()),n=r-1;if(a.val(n),e.removeAttr("disabled"),1==n&&t.attr("disabled","disabled"),in_cart&&n>=1){var i=a.attr("data-id"),o=n;ajax_update_cart(i,o)}})}function init_select2(t,a,e){t.val("").trigger("change"),t.select2({placeholder:a,matcher:matchCustom}),void 0!=e&&""!=e&&t.val(e).trigger("change")}function matchCustom(t,a){if(""===$.trim(t.term))return a;if("undefined"==typeof a.text)return null;var e=a.text.toLowerCase(),r=t.term.toLowerCase();if(e.indexOf(r)>-1){var n=$.extend({},a,!0);return n}return null}var document_height=$(document).height(),screen_height=$(window).height(),footer_height=$("#wrap_footer").height();$.ajaxSetup({complete:function(t,a){}}),$("#gotoTop").affix({offset:{bottom:footer_height+80}}),$(window).scroll(function(t){var a=$(window).scrollTop();a>=200?$("#gotoTop").fadeIn("fast"):$("#gotoTop").fadeOut("fast")}),$("body").on("click","#gotoTop",function(){$("html, body").animate({scrollTop:0},600,function(){$("#gotoTop").fadeOut("fast")})});var in_cart=!1;$("#wrap_giohang").length>0&&(in_cart=!0),$(document).ready(function(){if($('[rel="popover"]').popover({container:"body",placement:"bottom",html:!0,content:function(){var t=$($(this).data("popover-content")).clone(!0).removeClass("hide");return t}}),$("#nav_sanpham").webuiPopover({url:"#nav_sanpham_popover",placement:"bottom-right",onShow:function(t){$("html, body").animate({scrollTop:0},600,function(){$("body").addClass("fixed"),$("#nav_sanpham_bg").fadeIn(100)})},onHide:function(t){$("body").removeClass("fixed"),$("#nav_sanpham_bg").fadeOut("fast")}}),$("#slick_hotline").slick({infinite:!0,lazyLoad:"ondemand",slidesToShow:4,slidesToScroll:1}),$("#slick_hot_product").slick({infinite:!0,lazyLoad:"ondemand",slidesToShow:3,slidesToScroll:1}),$("#slick_sale_product").slick({infinite:!0,lazyLoad:"ondemand",slidesToShow:3,slidesToScroll:1}),$(".elastislide-list").length>0&&$("#carousel").elastislide({orientation:"vertical",autoplay:!1,minItems:5}),$(".product_zoom").length>0&&($(".product_zoom").elevateZoom({zoomWindowWidth:400,zoomWindowHeight:400,zoomWindowOffetx:10}),$(".wrap_thumbnail").find("a").each(function(){$(this).click(function(t){t.preventDefault();var a=$(this).attr("data-large");$(".wrap_large_picture").find("img").attr("src",a).attr("data-zoom-image",a);var e=$(".product_zoom").data("elevateZoom"),r=a,n=a;e.swaptheimage(r,n)})})),$("div.wrap_paging").jPages({containerID:"related_products",perPage:3,previous:"",next:""}),$(".item_number").find('input[name="item_number"]').length>0&&(number_input(".number_input"),add_cart()),$("#wrap_giohang").length>0&&$(".wrap_giohang_item").find(".delete_item").click(function(t){t.preventDefault();var a=$(this).parent().parent(".wrap_giohang_item"),e=$(this).attr("data-id");$.ajax({url:fUrl+"ajax_delete_cart",type:"POST",cache:!1,dataType:"json",data:{csrf_hash:$.cookie("csrf_cookie_ci"),post_id:e},success:function(t){if(1==t.error)swal("Rất tiếc...",t.msg,"error");else{a.fadeOut("slow"),t.total_item<=99?($("#wrap_cart #cart_number").html(t.total_item),0==t.total_item&&$(".btn_dathang").remove()):$("#wrap_cart #cart_number").html("99<plus>+</plus>");var r=$.number(t.sub_total,0,",",".");$(".wrap_item_"+e).find(".col_sub_total").find(".sub_total").children("span:last-child").html(r);var n=$.number(t.total,0,",",".");$(".wrap_giohang_tong").find(".total").html(n),$(".wrap_lbl_giohang").find(".number_item").html(t.total_item)}},error:function(){}})}),$("#wrap_checkout").length>0){var t=$('select[name="province_id_1"]'),a=$('select[name="province_id_2"]'),e=$('select[name="district_id_1"]'),r=$('select[name="district_id_2"]');init_select2(t,"Chọn tỉnh/thành phố"),init_select2(a,"Chọn tỉnh/thành phố"),init_select2(e,"Chọn quận/huyện"),init_select2(r,"Chọn quận/huyện"),t.change(function(){var t=$(this).val();e.val("").trigger("change"),e.select2({ajax:{url:fUrl+"ajax_get_district",dataType:"json",method:"post",data:function(){return{csrf_hash:$.cookie("csrf_cookie_ci"),province_id:t}},processResults:function(t){return{results:t}}}})}),$('input[name="same_address"]').change(function(){0==$(this).val()?($(".different_address").slideDown(),$('input[name="address_2"]').val("")):$(".different_address").slideUp()}),a.change(function(){var t=$(this).val();r.val("").trigger("change"),r.select2({ajax:{url:fUrl+"ajax_get_district",dataType:"json",method:"post",data:function(){return{csrf_hash:$.cookie("csrf_cookie_ci"),province_id:t}},processResults:function(t){return $('input[name="csrf_hash"]').val($.cookie("csrf_cookie_ci")),{results:t}}}})}),justNum($('input[name="phone"]'));var n=$("#frmCustomer").validate({rules:{fullname:{required:!0,maxlength:512},phone:{required:!0,maxlength:20},email:{email:!0}},messages:{fullname:{required:"bắt buộc nhập",maxlength:"tối đa 512 ký tự"},phone:{required:"bắt buộc nhập",maxlength:"tối đa 20 số"},email:{email:"email không đúng định dạng"}},highlight:function(t){$(t).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(t){$(t).closest(".form-group").removeClass("has-error").addClass("has-success")},errorElement:"span",errorClass:"help-block",errorPlacement:function(t,a){a.parent(".input-group").length?t.insertAfter(a.parent()):t.insertAfter(a)},submitHandler:function(t){t.submit()}})}});