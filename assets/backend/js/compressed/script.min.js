function showSmartAlert(t,e,a,i,r,n){$("body").css({overflow:"hidden"}),$.SmartMessageBox({title:t,content:e,buttons:a},function(t){"YES"===t?"function"==typeof i&&i():"NO"===t?"function"==typeof r&&r():"CANCEL"===t&&"function"==typeof n&&n(),$("body").css({overflow:"auto"})})}function replySuccess(t){return htmlStr='<div class="row reply">',htmlStr+='<div class="alert alert-success alert-block">',htmlStr+='<a class="close" data-dismiss="alert" href="#">×</a>',htmlStr+='<h4 class="alert-heading">Success!</h4>',htmlStr+=t,htmlStr+="</div>",htmlStr+="</div>",htmlStr}function replyError(t){return htmlStr='<div class="row reply">',htmlStr+='<div class="alert alert-danger alert-block">',htmlStr+='<a class="close" data-dismiss="alert" href="#">×</a>',htmlStr+='<h4 class="alert-heading">Error!</h4>',htmlStr+=t,htmlStr+="</div>",htmlStr+="</div>",htmlStr}function tableCommon(){jQuery(idTableList).jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!1,defaultSearch:"cn"}),$(".ui-jqgrid").removeClass("ui-widget ui-widget-content"),$(".ui-jqgrid-view").children().removeClass("ui-widget-header ui-state-default"),$(".ui-jqgrid-labels, .ui-search-toolbar").children().removeClass("ui-state-default ui-th-column ui-th-ltr"),$(".ui-jqgrid-pager").removeClass("ui-state-default"),$(".ui-jqgrid").removeClass("ui-widget-content"),$(".ui-jqgrid-htable").addClass("table table-bordered table-hover"),$(".ui-jqgrid-btable").addClass("table table-bordered table-striped"),$(".ui-pg-div").removeClass().addClass("btn btn-sm btn-primary"),$(".ui-icon.ui-icon-plus").removeClass().addClass("fa fa-plus"),$(".ui-icon.ui-icon-pencil").removeClass().addClass("fa fa-pencil"),$(".ui-icon.ui-icon-trash").removeClass().addClass("fa fa-trash-o"),$(".ui-icon.ui-icon-search").removeClass().addClass("fa fa-search"),$(".ui-icon.ui-icon-refresh").removeClass().addClass("fa fa-refresh"),$(".ui-icon.ui-icon-disk").removeClass().addClass("fa fa-save").parent(".btn-primary").removeClass("btn-primary").addClass("btn-success"),$(".ui-icon.ui-icon-cancel").removeClass().addClass("fa fa-times").parent(".btn-primary").removeClass("btn-primary").addClass("btn-danger"),$(".ui-icon.ui-icon-seek-prev").wrap("<div class='btn btn-sm btn-default'></div>"),$(".ui-icon.ui-icon-seek-prev").removeClass().addClass("fa fa-backward"),$(".ui-icon.ui-icon-seek-first").wrap("<div class='btn btn-sm btn-default'></div>"),$(".ui-icon.ui-icon-seek-first").removeClass().addClass("fa fa-fast-backward"),$(".ui-icon.ui-icon-seek-next").wrap("<div class='btn btn-sm btn-default'></div>"),$(".ui-icon.ui-icon-seek-next").removeClass().addClass("fa fa-forward"),$(".ui-icon.ui-icon-seek-end").wrap("<div class='btn btn-sm btn-default'></div>"),$(".ui-icon.ui-icon-seek-end").removeClass().addClass("fa fa-fast-forward"),$(window).on("resize.jqGrid",function(){$(idTableList).jqGrid("setGridWidth",$("#content").width())})}function actionSaveRow(t){jQuery(idTableList).jqGrid("saveRow",t,{aftersavefunc:function(t,e){responseText=$.parseJSON(e.responseText),"OK"==responseText.text?($(".reply").length>0&&$(".reply").remove(),$("#widget-grid").prepend(replySuccess("Edit data successful."))):($(".reply").length>0&&$(".reply").remove(),$("#widget-grid").prepend(replyError("Error edit data.")))}})}function captionButton(t,e){return caption="",1==t&&1==permissionsMember[currentModule.control_name][2]&&(caption+='<a id="btnAdd" href="'+bUrl+currentModule.url+'/add" class="btnTop btn btn-success"><i class="fa fa-plus"></i> Add</a>'),1==e&&1==permissionsMember[currentModule.control_name][4]&&(caption+='<a id="btnMultiDelete" href="#" class="btnTop btn btn-danger"><i class="fa fa-trash-o"></i> Delete</a>'),caption}function captionExport(t){return'<a id="btnExport" href="'+bUrl+t+'/export_db" class="btnTop btn btn-primary"><i class="fa fa-cloud-download"></i> Export</a>'}function captionImport(t){return'<a id="btnImport" href="#" class="btnTop btn btn-default"><i class="fa fa-cloud-upload"></i> Import</a>'}function btnEditInline(t){return buttons="",1==permissionsMember[currentModule.control_name][3]&&(buttons+='<a href="'+bUrl+currentModule.url+"/edit/"+t+'" data-id="'+t+'" class="btn btn-primary btn-xs btnEdit"><i class="fa fa-edit"></i></a>'),buttons}function bntDeleteInline(t){return buttons="",1==permissionsMember[currentModule.control_name][4]&&(buttons+='<a href="'+bUrl+currentModule.url+"/delete/"+t+'" data-id="'+t+'" class="btn btn-danger btn-xs btnDelete"><i class="fa fa-trash-o"></i></a>'),buttons}function init_Radio(){$(".radioWrapper").length>0&&$("body").find(".radioWrapper").each(function(){var t=$(this).attr("id"),e=$("#"+t),a=e.find("input[name=status]:checked");void 0!=a&&(a.parent("label").addClass("active"),a.parent("label").addClass(arrStatus[a.val()][0]),a.parent("label").addClass(arrStatus[a.val()][1])),e.on("click","label.btn",function(){var t=$(this),e=t.children("input"),a=t.parent(".btn-group"),i=e.is(":checked");i||(a.find("input:checked").removeAttr("checked"),a.find("label").attr("class","btn btn-default"),t.addClass(arrStatus[e.val()][0]).addClass(arrStatus[e.val()][1]),e.attr("checked","checked"))})})}function formatButton(t,e,a,i,r){return activeClass=arrStatus[e][0]+" "+arrStatus[e][1],fa='<button id="'+a+t+'" class="btn '+i+" "+activeClass+'" data-id="'+t+'" data-toggle="modal" data-target="#'+r+'">',fa+=e,fa+="</button>",fa}function click_btnInGrid(t,e,a,i){var r;$("."+t).click(function(){r=$(this).attr("id"),$("#"+e+" .modal-content").position({my:"left top",at:"left top",of:$(this)})}),$("#"+e).parent().on("webkitTransitionEnd oTransitionEnd transitionend msTransitionEnd",function(){-1==$("#"+e).attr("class").indexOf("in")&&$("#"+e+" .modal-content").css({left:"0px",top:"0px"})}),$("#"+e+" .btn").click(function(){var t=$("#"+r).html(),n=$(this).attr("data-value");$("#"+e).modal("hide"),t!=n&&(id=$("#"+r).attr("data-id"),$.ajax({url:a,type:"POST",cache:!1,dataType:"text",data:{id:id,value:n,csrf_hash:$.cookie("csrf_cookie_ci")},success:function(t){"true"==t?"function"==typeof i&&i():"false"==t?showSmartAlert("Error","Can send data. Please contact to admin.","[YES]"):showSmartAlert("Error","You does not have permission to edit data. Please contact to admin.","[YES]")},error:function(){showSmartAlert("Error","Can send data. Please contact to admin.","[YES]")}}))})}function treeView(){$(".tree").length>0&&($(".tree").find("li").addClass("parent_li").attr("role","treeitem").children("span").on("click",function(){$(".tree").find("li").children("span").removeClass("label-success"),$(this).addClass("label-success"),$(this).closest(".wrap_tree").find('input[name="selected_category_id"]').val($(this).attr("data-id")),$(this).closest(".wrap_tree").find('input[name="selected_category_name"]').val($(this).attr("data-name")),$(this).closest(".wrap_tree").find('input[name="parent_id"]').val($(this).closest("ul").prev("span").attr("data-id"))}),$("body").on("click",".tree ul li span i",function(){var t=$(this).parent("span").parent("li").children("ul");-1!=$(this).attr("class").indexOf("fa-minus-circle")?("undefined"!=t&&t.hide("fast"),$(this).removeClass().addClass("fa fa-sm fa-plus-circle")):("undefined"!=t&&t.show("fast"),$(this).removeClass().addClass("fa fa-sm fa-minus-circle"))}),$(".tree").find("li:has(ul)").each(function(){$(this).children("span").children("i").removeClass("fa-plus-circle").addClass("fa-minus-circle")}))}function positiveInteger(){$(".positive-integer").length>0&&$(".positive-integer").numeric({decimal:!1,negative:!1},function(){this.value="",this.focus()})}function openKCFinder(t,e,a){window.KCFinder={callBack:function(e){t.val(e),window.KCFinder=null,"function"==typeof a&&a()}},"images"==e?window.open(libsUrl+"kcfinder/browse.php?type=images&dir=images/public","kcfinder_textbox","status=0, toolbar=0, location=0, menubar=0, directories=0, resizable=1, scrollbars=0, width=800, height=600"):"docs"==e?window.open(libsUrl+"kcfinder/browse.php?type=docs&dir=docs/public","kcfinder_textbox","status=0, toolbar=0, location=0, menubar=0, directories=0, resizable=1, scrollbars=0, width=800, height=600"):"media"==e&&window.open(libsUrl+"kcfinder/browse.php?type=media&dir=media/public","kcfinder_textbox","status=0, toolbar=0, location=0, menubar=0, directories=0, resizable=1, scrollbars=0, width=800, height=600")}function openKCFinderMulti(t,e,a,i){window.KCFinder={callBackMultiple:function(e){window.KCFinder=null;var a=new Array;""!=t.val()&&(a=JSON.parse(t.val()));for(var r=0;r<e.length;r++)a.push(e[r]);t.val(JSON.stringify(a)),"function"==typeof i&&i()}},"images"==e?window.open(libsUrl+"kcfinder/browse.php?type=images&dir=images/public","kcfinder_multiple","status=0, toolbar=0, location=0, menubar=1, directories=0, resizable=1, scrollbars=0, width=800, height=600"):"docs"==e&&window.open(libsUrl+"kcfinder/browse.php?type=docs&dir=docs/public","kcfinder_multiple","status=0, toolbar=0, location=0, menubar=0, directories=0, resizable=1, scrollbars=0, width=800, height=600")}function selectFile(t,e,a,i){$("body").on("click",t,function(){("images"==e||"media"==e)&&(thumbnailWrapper=$(this).parent().parent().next(".thumbnailWrapper")),void 0==a||""==a?(inputField=$(this).parent().prev(".inputThumbnail"),openKCFinder(inputField,e,function(){filename=inputField.val(),"images"==e?(typeDir="images/",htmlImg='<img src="'+filename+'" class="thumbnail" />',htmlDel='<a class="thumbnailDel"><i class="fa fa-trash-o"></i></a>',nameLinkInput=inputField.attr("name"),void 0==i||""==i?htmlLink="":1==i&&(htmlLink='<div class="row">',htmlLink+='<label style="float: left; clear: both;">Link</label>',htmlLink+='<input type="text" name="'+nameLinkInput+'_link" class="inputThumbnail form-control" style="float: left; clear: both" />',htmlLink+="</div>"),thumbnailWrapper.html("").html('<div class="thumbnailItem">'+htmlImg+htmlDel+htmlLink+"</div>")):"media"==e&&(htmlStr='<video id="video" width="320" controls="true">',htmlStr+='<source src="'+filename+'">',htmlStr+="Your browser does not support HTML5 video tag. Please download FireFox 3.5 or higher.",htmlStr+="</video><br/>",thumbnailWrapper.html("").html(htmlStr))})):(inputField=$(this).parent().prev(".inputThumbnail"),openKCFinderMulti(inputField,e,i,function(){if("images"==e){typeDir="images/";var t=JSON.parse(inputField.val());htmlImgList="",$.each(t,function(t,e){htmlImg='<img src="'+e+'" class="thumbnail" />',htmlDel='<a class="thumbnailDel"><i class="fa fa-trash-o"></i></a>',void 0==i||""==i?htmlLink="":(htmlLink='<div class="">',htmlLink+='<label style="float: left; clear: both;">Link</label>',htmlLink+='<input type="text" name="thumbnail_links[]" class="form-control" style="float: left; clear: both" />',htmlLink+="</div>"),htmlImgList+='<div class="thumbnailItem">'+htmlImg+htmlDel+htmlLink+"</div>"}),thumbnailWrapper.html("").html(htmlImgList)}}))})}function setOrder(){$(".orderSpinner").length>0&&($(".orderSpinner").spinner({min:0,max:99,step:1,start:1e3,numberFormat:"C"}),$("body").on("change",'input[name="order"]',function(){""==$(this).val()?$(this).val(0):$(this).val()>100&&$(this).val(99)}))}function selectCategory(t,e){$("body").on("click",t,function(){inputField=$(t).parent().next("input"),index=$(this).index(),value=$(this).attr("data-save"),$(t).removeClass("btn-success"),$(this).addClass("btn-success"),inputField.val(value),"function"==typeof e&&e(index,value)})}function capture(t,e){null==e&&(e=1);var a=t.videoWidth*e,i=t.videoHeight*e,r=document.createElement("canvas");r.width=a,r.height=i;var n=r.getContext("2d");return n.drawImage(t,0,0,a,i),r}function shoot(){var t=document.getElementById(videoId),e=document.getElementById("output"),a=capture(t,scaleFactor);a.onclick=function(){window.open(this.toDataURL())},snapshots.unshift(a),e.innerHTML="";for(var i=0;4>i;i++)e.appendChild(snapshots[i])}function valid_login(){$("#login_form").validate({rules:{username:{required:!0,maxlength:255},captcha:{required:!0},password:{required:!0,maxlength:255}},messages:{username:{required:"not empty",maxlength:"must less 255 characters"},password:{required:"not empty",maxlength:"must less 255 characters"},captcha:{required:"not empty"}},submitHandler:function(t){t.submit()}})}function refresh_captcha(){$("#captcha_refesh").click(function(){btnRefesh=$(this),sc=btnRefesh.prev("img").attr("id"),$.ajax({url:bUrl+"auth/ajax_captcha",type:"POST",cache:!1,dataType:"json",data:{sc:sc,csrf_hash:$.cookie("csrf_cookie_ci")},success:function(t){btnRefesh.prev("img").remove(),btnRefesh.before(t),$('input[name="csrf_hash"]').val($.cookie("csrf_cookie_ci"))},error:function(){alert("Error ! Can not load data.")}})})}function dashboardPage(){$("#dashboardPage").length>0&&(module="dashboard")}function userPage(){if($("#userPage").length>0&&(module="user",$(idTableList).length>0)){var t=":All;active:Active;inactive:Inactive";caption=captionButton(module,!1,!1),caption+=captionExport(module),jQuery(idTableList).jqGrid({url:bUrl+module+"/ajax_list?q=2",datatype:"json",height:"auto",autowidth:!0,shrinkToFit:!1,gridResize:!0,autoResizeAllColumns:!0,iconSet:"fontAwesome",colNames:["Status","Email","Max Score","Time","Regist Datetime"],colModel:[{name:"status",index:"status",align:"center",width:"80",stype:"select",searchoptions:{sopt:["eq"],value:t}},{name:"email",index:"email",align:"left",search:!0,width:"400"},{name:"score",index:"score",align:"center",search:!0,width:"100"},{name:"time",index:"time",align:"center",search:!0,width:"100"},{name:"created_datetime",index:"created_datetime",align:"center",search:!0,width:"200"}],rownumbers:!0,rowNum:defaultNumRows,rowList:[10,20,defaultNumRows],pager:idPager,sortname:"id",sortorder:"asc",toolbarfilter:!0,viewrecords:!0,gridComplete:function(){for(var t=jQuery(idTableList).jqGrid("getDataIDs"),e=0;e<t.length;e++){var a=t[e],i=jQuery(idTableList).jqGrid("getRowData",a),r=i.id-3,n="",n=formatButton(a,i.status,"btnStatus_","btnStatus","modalStatus"),s="";""!=i.thumbnail&&(s='<img src="'+i.thumbnail+'" class="thumbInTable" />');var l=btnEditInline(module,a,!0)+bntDeleteInline(module,!1,a,!0);jQuery(idTableList).jqGrid("setRowData",t[e],{id:r,status:n,thumbnail:s,act:l})}click_btnInGrid("btnStatus","modalStatus",bUrl+module+"/ajax_status",arrClassValue_Status,function(){location.reload()})},subGrid:!0,subGridBeforeExpand:function(t,e){},subGridRowExpanded:function(t,e){var a,i;a=t+"_t",i="p_"+a,$("#"+t).html("<table id='"+a+"' class='scroll subTable'></table><div id='"+i+"' class='scroll'></div>"),jQuery("#"+a).jqGrid({url:bUrl+module+"/ajax_sublist?q=2&id="+e,datatype:"json",colNames:["Score","Time","Datetime"],colModel:[{name:"total_score",index:"total_score",width:"200",align:"center"},{name:"client_time",index:"client_time",width:"200",align:"center"},{name:"created_datetime",index:"created_datetime",width:"200",align:"center"}],rownumbers:!0,rowNum:20,sortname:"id",sortorder:"asc",height:"100%",gridComplete:function(){for(var t=jQuery("#"+a).jqGrid("getDataIDs"),e=0;e<t.length;e++){var i=t[e],r=jQuery("#"+a).jqGrid("getRowData",i);""==r.total_score?ts=0:ts=r.total_score,1==r.right?right='<span class="label label-primary">TRUE</span>':right='<span class="label label-danger">FALSE</span>',jQuery("#"+a).jqGrid("setRowData",t[e],{right:right,total_score:ts})}}})},subGridRowColapsed:function(t,e){},ajaxRowOptions:{async:!0},caption:caption,multiselect:!0,loadBeforeSend:function(){$(this).closest("div.ui-jqgrid-view").find("table.ui-jqgrid-htable>thead>tr>th").css({"text-align":"center"})},onSelectRow:function(t){}}),tableCommon(),$("body").on("click",".btnDelete",function(t){t.preventDefault(),selectedRows=jQuery(idTableList).jqGrid("getGridParam","selarrrow"),href=$(this).attr("href"),showSmartAlert("Warning","<p>Are you sure delete data ?</p>","[NO][YES]",function(){$("#ids").val(selectedRows),$("#frmTopButtons").submit()},function(){})}),$("body").on("click","#btnMultiDelete",function(t){t.preventDefault(),href=$(this).attr("href"),selectedRows=jQuery(idTableList).jqGrid("getGridParam","selarrrow"),0==selectedRows.length?showSmartAlert("Error","Please select data.","[YES]"):showSmartAlert("Warning","<p>Are you sure delete data ?</p>","[NO][YES]",function(){$("#ids").val(selectedRows),$("#frmTopButtons").submit()},function(){})})}}var idTableList="#jqgrid",idPager="#pjqgrid",defaultNumRows=50,defaultIMG='<img class="thumbnail" src="'+fUrl+'assets/common/images/default.jpg" />',clsTextColor_Status="txt-color-white",clsBgColor_ActiveStatus="bg-color-green",clsBgColor_InactiveStatus="bg-color-blueDark",clsBgColor_BlockStatus="bg-color-red",arrStatus=new Array;arrStatus.active=["bg-color-green","txt-color-white"],arrStatus.inactive=["bg-color-blueDark","txt-color-white"],arrStatus.block=["bg-color-red","txt-color-white"];var videoId="video",scaleFactor=.25,snapshots=[];$(document).ready(function(){$(".btnCancel").length>0&&$(".btnCancel").click(function(){window.history.back()}),init_Radio(),0==$("#login_form").length&&"undefined"!=typeof replyErrorContent&&null!==replyErrorContent&&""!==replyErrorContent&&showSmartAlert("Error",replyErrorContent,"[YES]"),$("#frmImport").length>0&&($("body").on("click","a#btnImport",function(t){t.preventDefault(),$('input[name="importFile"]').click()}),$("body").on("change",'input[name="importFile"]',function(t){processing_on(),$("#frmImport").submit()})),pageSetUp(),positiveInteger(),setOrder(),$("#login_form").length>0&&(valid_login(),refresh_captcha()),dashboardPage(),userPage()});